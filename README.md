# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞ —Å –ò–ò

–¶–∏—Ñ—Ä–æ–≤–æ–π –∞–≤–∞—Ç–∞—Ä ‚Äî —ç—Ç–æ 3D-–º–æ–¥–µ–ª—å, –∫–æ—Ç–æ—Ä–∞—è –ø–æ—Ö–æ–∂–∞ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞.
–≠—Ç–æ –Ω–µ —Å—Ç–∞—Ç–∏—á–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞, –∞ –∏–º–∏—Ç–∞—Ü–∏—è —Ä–µ–∞–ª—å–Ω–æ–π –∂–∏–∑–Ω–∏.

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–ø–æ—Å–æ–±—ã —Å–æ–∑–¥–∞–Ω–∏—è —Ü–∏—Ñ—Ä–æ–≤—ã—Ö –∞–≤–∞—Ç–∞—Ä–æ–≤:

* 3D-–º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–∞—è –≥—Ä–∞—Ñ–∏–∫–∞. –í–Ω–µ—à–Ω–æ—Å—Ç—å –∞–≤–∞—Ç–∞—Ä–∞, –µ–≥–æ –º–∏–º–∏–∫—É –∏ –¥–≤–∏–∂–µ–Ω–∏—è –ø—Ä–æ—Ä–∏—Å–æ–≤—ã–≤–∞—é—Ç –¥–∏–∑–∞–π–Ω–µ—Ä—ã –∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã.
* –ù–µ–π—Ä–æ—Å–µ—Ç—å –∏ –∫–æ—Å—Ç—é–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—Ç –¥–≤–∏–∂–µ–Ω–∏—è –∏ –º–∏–º–∏–∫—É —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∞–∫—Ç—ë—Ä–∞. –ü–æ–≤–µ—Ä—Ö –¥–≤–∏–∂–µ–Ω–∏–π —á–µ–ª–æ–≤–µ–∫–∞ –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–∞—è –≥—Ä–∞—Ñ–∏–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –º–µ–Ω—è–µ—Ç –µ–≥–æ –≤–Ω–µ—à–Ω–æ—Å—Ç—å. –ü–æ–ª—É—á–∞–µ—Ç—Å—è —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è 3D-–º–æ–¥–µ–ª—å —Å —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–º–∏ —ç–º–æ—Ü–∏—è–º–∏.

–¶–∏—Ñ—Ä–æ–≤—ã–µ –∞–≤–∞—Ç–∞—Ä—ã –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –≤ –ª—é–±–æ–π —Å—Ñ–µ—Ä–µ. –û–Ω–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–∞–º–∏ –≤ –±–∞–Ω–∫–∞—Ö –∏–ª–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞—Ö, –º–æ–¥–µ–ª—è–º–∏ –Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –ø–æ–∫–∞–∑–∞—Ö, –ª–µ–∫—Ç–æ—Ä–∞–º–∏ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –∫—É—Ä—Å–æ–≤ –∏ –∞–º–±–∞—Å—Å–∞–¥–æ—Ä–∞–º–∏ –±—Ä–µ–Ω–¥–æ–≤.

–ó–¥–µ—Å—å –º—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫—É —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ò–ò.
–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞: [—Å—Å—ã–ª–∫–∞](resources/digital-avatar.mov).

## –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞

–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞ –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è —Å–ª–µ–¥—É—é—â–∏–µ —ç—Ç–∞–ø—ã:

* 3D-–º–æ–¥–µ–ª—å - –≤–Ω–µ—à–Ω–æ—Å—Ç—å –∞–≤–∞—Ç–∞—Ä–∞.
* Lip sync - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–≤–∏–∂–µ–Ω–∏–π –≥—É–± –∞–≤–∞—Ç–∞—Ä–∞ —Å –ø—Ä–æ–∏–∑–Ω–æ—Å–∏–º—ã–º–∏ —Å–ª–æ–≤–∞–º–∏.
* –°–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏ - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—á–∏ –∞–≤–∞—Ç–∞—Ä–∞.
* –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏ - —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–æ–Ω–∏–º–∞—Ç—å —á–µ–ª–æ–≤–µ—á–µ—Å–∫—É—é —Ä–µ—á—å.
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ò–ò - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–æ–º.
* –û–±—É—á–µ–Ω–∏–µ - –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–±—É—á–µ–Ω–∏—è –∞–≤–∞—Ç–∞—Ä–∞ –Ω–æ–≤—ã–º –∑–Ω–∞–Ω–∏—è–º.

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ —Ü–∏—Ñ—Ä–æ–≤–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞

### –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã

–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –≤ Unity. –í –ø—Ä–∏–º–µ—Ä–µ –±—É–¥–µ—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ Unity 6000.

### 3D-–º–æ–¥–µ–ª—å

3D-–º–æ–¥–µ–ª—å —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∞—Ö –¥–ª—è –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è. –î–∏–∑–∞–π–Ω–µ—Ä—ã –∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞–¥ –≤–Ω–µ—à–Ω–æ—Å—Ç—å—é –∞–≤–∞—Ç–∞—Ä–∞, –µ–≥–æ –º–∏–º–∏–∫–æ–π –∏ –¥–≤–∏–∂–µ–Ω–∏—è–º–∏.

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤–∑—è—Ç—å –≥–æ—Ç–æ–≤—É—é 3D-–º–æ–¥–µ–ª—å —Å —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã–º–∏ –∫–æ—Å—Ç—è–º–∏, –≤–µ—Å–∞–º–∏ –∏ –∞–Ω–∏–º–∞—Ü–∏—è–º–∏.

–í –ø—Ä–æ–µ–∫—Ç–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è 3D-–º–æ–¥–µ–ª—å [Unity-Chan](https://unity-chan.com/download/index.php).

–ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–≤–æ—ë 3D-–º–æ–¥–µ–ª–∏ –≤ –ø—Ä–æ–µ–∫—Ç, –¥–æ–±–∞–≤—å—Ç–µ –µ—ë –Ω–∞ —Å—Ü–µ–Ω—É.

### Lip sync

Lip sync ‚Äî —ç—Ç–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–≤–∏–∂–µ–Ω–∏–π –≥—É–± –∞–≤–∞—Ç–∞—Ä–∞ —Å –ø—Ä–æ–∏–∑–Ω–æ—Å–∏–º—ã–º–∏ —Å–ª–æ–≤–∞–º–∏. –î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–∞—Å–ø–æ–∑–Ω–∞—é—Ç —Ä–µ—á—å –∏ –ø–µ—Ä–µ–¥–∞—é—Ç –¥–∞–Ω–Ω—ã–µ –≤ –ø—Ä–æ–≥—Ä–∞–º–º—É –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏.

–î–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ lip sync —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É [uLipSync](https://github.com/hecomi/uLipSync).

![Lip sync](https://raw.githubusercontent.com/wiki/hecomi/uLipSync/Unity-Chan.gif)

#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ uLipSync

–î–æ–±–∞–≤—å—Ç–µ uLipSync –≤ –ø—Ä–æ–µ–∫—Ç:

* –ó–∞–≥—Ä—É–∑–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é .unitypackage —Å–æ [—Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—ã–ø—É—Å–∫–∞](https://github.com/hecomi/uLipSync/releases). –¢–∞–∫–∂–µ –∂–µ –¥–æ–±–∞–≤—è—Ç—Å—è –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.
* –î–æ–±–∞–≤—å—Ç–µ <https://github.com/hecomi/uLipSync.git#upm> –≤ –¥–∏—Å–ø–µ—Ç—á–µ—Ä –ø–∞–∫–µ—Ç–æ–≤. –ë–µ–∑ –ø—Ä–∏–º–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ uLipSync

* –ü–æ—Å–ª–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –º–æ–¥–µ–ª–∏ –∞–≤–∞—Ç–∞—Ä–∞ –¥–æ–±–∞–≤—å—Ç–µ AudioSource –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫ –ª—é–±–æ–º—É –∏–≥—Ä–æ–≤–æ–º—É –æ–±—ä–µ–∫—Ç—É, –≥–¥–µ –±—É–¥–µ—Ç –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—å—Å—è –∑–≤—É–∫.
* –î–æ–±–∞–≤—å—Ç–µ uLipSync –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫ —Ç–æ–º—É –∂–µ GameObject. –í—ã–±–µ—Ä–∏—Ç–µ uLipSync-Profile –∏–∑ —Å–ø–∏—Å–∫–∞ –∏ –Ω–∞–∑–Ω–∞—á—å—Ç–µ –µ–≥–æ —Å–ª–æ—Ç—É –¥–ª—è –ø—Ä–æ—Ñ–∏–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞.
* –î–æ–±–∞–≤—å—Ç–µ uLipSyncBlendShape –∫ –∫–æ—Ä–Ω—é Unity-chan's SkinnedMeshRenderer. –í—ã–±–µ—Ä–∏—Ç–µ —Ü–µ–ª–µ–≤—É—é —Ñ–æ—Ä–º—É —Å–æ—á–µ—Ç–∞–Ω–∏—è, MTH_DEF –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Blend Shapes > Phoneme table - BlendShape –∏ –¥–æ–±–∞–≤—å—Ç–µ 7 —ç–ª–µ–º–µ–Ω—Ç–æ–≤: A, I, U, E, O, N –∏ -, –Ω–∞–∂–∞–≤ –∫–Ω–æ–ø–∫—É + ("-" –¥–ª—è —à—É–º–∞). –ó–∞—Ç–µ–º –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º—É —Å–æ—á–µ—Ç–∞–Ω–∏—è, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–∞–∂–¥–æ–π —Ñ–æ–Ω–µ–º–µ, –∫–∞–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º —Ä–∏—Å—É–Ω–∫–µ.
* –ù–∞–∫–æ–Ω–µ—Ü, —á—Ç–æ–±—ã —Å–æ–µ–¥–∏–Ω–∏—Ç—å –∏—Ö, –≤ uLipSync –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Parameters > On Lip Sync Updated (LipSyncInfo) –∏ –Ω–∞–∂–º–∏—Ç–µ +, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ, –∑–∞—Ç–µ–º –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–≥—Ä–æ–≤–æ–π –æ–±—ä–µ–∫—Ç (–∏–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç) —Å uLipSyncBlendShape –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º, –≥–¥–µ –Ω–∞–ø–∏—Å–∞–Ω–æ None (Object). –ù–∞–π–¥–∏—Ç–µ uLipSyncBlendShape –≤ —Ä–∞—Å–∫—Ä—ã–≤–∞—é—â–µ–º—Å—è —Å–ø–∏—Å–∫–µ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ OnLipSyncUpdate –≤ –Ω–µ–º.

–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –≤—ã –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ –∏–≥—Ä—É, –Æ–Ω–∏—Ç–∏-—Ç—è–Ω –±—É–¥–µ—Ç —à–µ–≤–µ–ª–∏—Ç—å –≥—É–±–∞–º–∏, –∫–æ–≥–¥–∞ –æ–Ω–∞ –≥–æ–≤–æ—Ä–∏—Ç.

### –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏

–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏ ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø–æ–Ω–∏–º–∞—Ç—å —á–µ–ª–æ–≤–µ—á–µ—Å–∫—É—é —Ä–µ—á—å. –î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã–µ –≤ —Ç–µ–∫—Å—Ç.

–í Unity –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É [whisper.unity](https://github.com/Macoron/whisper.unity/tree/master?tab=readme-ov-file).

#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ whisper.unity

* –ú–æ–∂–Ω–æ —Å–∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –æ—Ç–∫—Ä—ã—Ç—å –µ–≥–æ –∫–∞–∫ –æ–±—ã—á–Ω—ã–π Unity –ø—Ä–æ–µ–∫—Ç. –û–Ω –ø–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏ –∫—Ä–æ—à–µ—á–Ω—ã–º–∏ –≤–µ—Å–∞–º–∏ –º–Ω–æ–≥–æ—è–∑—ã—á–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π. <https://github.com/Macoron/whisper.unity>.
* –í –∫–∞—á–µ—Å—Ç–≤–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã –≤—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å —ç—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –≤ —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç –≤ –≤–∏–¥–µ –ø–∞–∫–µ—Ç–∞ Unity. –î–æ–±–∞–≤—å—Ç–µ –µ–≥–æ –ø–æ —ç—Ç–æ–º—É URL-–∞–¥—Ä–µ—Å—É git –≤ –≤–∞—à –º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–∫–µ—Ç–æ–≤ Unity: <https://github.com/Macoron/whisper.unity.git?path=/Packages/com.whisper.unity>.

#### –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª—å–Ω—ã—Ö –≤–µ—Å–æ–≤

–í—ã –º–æ–∂–µ—Ç–µ —Å–∫–∞—á–∞—Ç—å –º–æ–¥–µ–ª—å–Ω—ã–µ –≤–µ—Å–∞ [–æ—Ç—Å—é–¥–∞](https://huggingface.co/ggerganov/whisper.cpp). –ü—Ä–æ—Å—Ç–æ –ø–æ–ª–æ–∂–∏—Ç–µ –∏—Ö –≤ —Å–≤–æ—é StreamingAssets –ø–∞–ø–∫—É.

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ whisper.unity

* –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—É—Å—Ç–æ–π GameObject –∏ –¥–æ–±–∞–≤—å—Ç–µ –∫ –Ω–µ–º—É WhisperManager.
* –£–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ –º–æ–¥–µ–ª—å–Ω—ã–º –≤–µ—Å–∞–º –≤ WhisperManager –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ StreamingAssets –ø–∞–ø–∫–∏.
* –ü–æ–º–µ–Ω—è–π—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —è–∑—ã–∫–∞ –Ω–∞ `ru`.

WhisperManager –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.

#### –°—á–∏—Ç—ã–≤–∞–Ω–∏–µ –∞—É–¥–∏–æ —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞

–î–ª—è —Å—á–∏—Ç—ã–≤–∞–Ω–∏—è –∞—É–¥–∏–æ —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É [Microphone](https://docs.unity3d.com/ScriptReference/Microphone.html).

```csharp
public interface IAudioRecorder
{
    void StartRecording();
    void StopRecording();
    float[] ReadAudioData();

    void SetMicrophoneIndex(int index);
}
```

–ë—ã–ª —Å–æ–∑–¥–∞–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `IAudioRecorder`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–æ–º.
–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–∑–≤–æ–ª–∏—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è:

* –ù–∞—á–∞—Ç—å –∑–∞–ø–∏—Å—å –∞—É–¥–∏–æ. –ú–µ—Ç–æ–¥ `StartRecording`.
* –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å –∞—É–¥–∏–æ. –ú–µ—Ç–æ–¥ `StopRecording`.
* –ü—Ä–æ—á–∏—Ç–∞—Ç—å –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã–µ. –ú–µ—Ç–æ–¥ `ReadAudioData`.
* –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞. –ú–µ—Ç–æ–¥ `SetMicrophoneIndex`.

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ `IAudioRecorder`, –¥–æ–±–∞–≤–∏–º –±–∞–∑–æ–≤—ã–µ –ø–µ—Ä–∞–º–µ—Ç—Ä—ã –∏ –º–µ—Ç–æ–¥—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞.

```csharp
using UnityEngine;

public class AudioRecorder : IAudioRecorder
{
    private int _microphoneIndex;
    private AudioClip _microphoneClip;
    private int _position1, _position2;

    public void SetMicrophoneIndex(int index)
    {
        _microphoneIndex = index;
    }
}
```

–î–æ–±–∞–≤–∏–º –º–µ—Ç–æ–¥—ã –¥–ª—è –Ω–∞—á–∞–ª–∞ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–ø–∏—Å–∏ –∞—É–¥–∏–æ.

–ü—Ä–∏ –Ω–∞—á–∞–ª–µ –∑–∞–ø–∏—Å–∏ –∞—É–¥–∏–æ –º—ã —É–Ω–∏—á—Ç–æ–∂–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∞—É–¥–∏–æ –∫–ª–∏–ø, –µ—Å–ª–∏ –æ–Ω —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –∏ –Ω–∞—á–∏–Ω–∞–µ–º –∑–∞–ø–∏—Å—å –Ω–æ–≤–æ–≥–æ –∞—É–¥–∏–æ.

```csharp
public void StartRecording()
{
    if (_microphoneClip != null)
    {
        Object.Destroy(_microphoneClip);
    }

    _microphoneClip = Microphone.Start(Microphone.devices[_microphoneIndex], true, 3500, 16000);
    _position1 = 0;
}
```

–ü—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –∑–∞–ø–∏—Å–∏ –∞—É–¥–∏–æ –º—ã –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–ø–∏—Å—å –∏ –∏–∑–±–∞–≤–ª—è–µ–º—Å—è –æ—Ç –∞—É–¥–∏–æ –∫–ª–∏–ø–∞.

```csharp
public void StopRecording()
{
    if (_microphoneClip == null) return;
    
    Microphone.End(Microphone.devices[_microphoneIndex]);

    _microphoneClip = null;

    _position1 = 0;
    _position2 = 0;
}
```

–î–æ–±–∞–≤–∏–º –º–µ—Ç–æ–¥ –¥–ª—è —á—Ç–µ–Ω–∏—è –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã—Ö.

–ú–µ—Ç–æ–¥ `ReadAudioData` —Å—á–∏—Ç—ã–≤–∞–µ—Ç –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ –∞—É–¥–∏–æ –∫–ª–∏–ø–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏—Ö. –°–Ω–∞—á–∞–ª–∞ –º—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∞—É–¥–∏–æ –∫–ª–∏–ø —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –∑–∞–ø–∏—Å—å –≤–µ–¥—ë—Ç—Å—è. –ó–∞—Ç–µ–º –º—ã —Å—á–∏—Ç—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –∞—É–¥–∏–æ –∫–ª–∏–ø–∞ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–∑–∏—Ü–∏—è —É–≤–µ–ª–∏—á–∏–ª–∞—Å—å. –ï—Å–ª–∏ –ø–æ–∑–∏—Ü–∏—è —É–≤–µ–ª–∏—á–∏–ª–∞—Å—å, —Ç–æ —Å—á–∏—Ç—ã–≤–∞–µ–º –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ –∞—É–¥–∏–æ –∫–ª–∏–ø–∞ –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é.

```csharp
public float[] ReadAudioData()
{
    if (_microphoneClip == null || !Microphone.IsRecording(Microphone.devices[_microphoneIndex])) return null;

    _position2 = Microphone.GetPosition(Microphone.devices[_microphoneIndex]);

    if (_position2 <= _position1) return null;

    var audioData = new float[_position2 - _position1];
    _microphoneClip.GetData(audioData, _position1);

    _position1 = _position2;

    return audioData;
}
```

#### –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å –ª–æ–∫–∞—Ç–æ—Ä–∞

–°–µ—Ä–≤–∏—Å –ª–æ–∫–∞—Ç–æ—Ä ‚Äî —ç—Ç–æ –ø–∞—Ç—Ç–µ—Ä–Ω –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å–µ—Ä–≤–∏—Å–∞–º –≤ –ª—é–±–æ–º –º–µ—Å—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

–°–æ–∑–¥–∞–¥–∏–º —Å–µ—Ä–≤–∏—Å –ª–æ–∫–∞—Ç–æ—Ä –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ `IAudioRecorder` –∏ –∫ –¥—Ä—É–≥–∏–º —Å–µ—Ä–≤–∏—Å–∞–º –≤ –±—É–¥—É—â–µ–º.

```csharp
using System;
using System.Collections.Generic;

public class ServiceLocator
{
    public static ServiceLocator Instance => _instance ??= new ServiceLocator();
    private static ServiceLocator _instance;

    private readonly Dictionary<Type, object> _services = new();

    public void Register<T>(object service) => _services[typeof(T)] = service;

    public T Get<T>() => (T)_services[typeof(T)];

    public void Clear() => _services.Clear();

    public void Unregister<T>() => _services.Remove(typeof(T));

    public bool Contains<T>() => _services.ContainsKey(typeof(T));
}
```

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–π —Å–µ—Ä–≤–∏—Å –ª–æ–∫–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å, –ø–æ–ª—É—á–∞—Ç—å –∏ —É–¥–∞–ª—è—Ç—å —Å–µ—Ä–≤–∏—Å—ã.

#### –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Å—Ç–∞–ª–ª–µ—Ä–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–ò–Ω—Å—Ç–∞–ª–ª–µ—Ä –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π ‚Äî —ç—Ç–æ –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è —Ç–æ—á–∫–æ–π –≤—Ö–æ–¥–∞ –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

```csharp
using UnityEngine;

public class DependencyInstaller : MonoBehaviour
{
    private void Awake()
    {
        var serviceLocator = ServiceLocator.Instance;

        var audioRecorder = new AudioRecorder();
        serviceLocator.Register<IAudioRecorder>(audioRecorder);
    }
}
```

–î–æ–±–∞–≤—å—Ç–µ –∏–Ω—Å—Ç–∞–ª–ª–µ—Ä –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –Ω–∞ —Å—Ü–µ–Ω—É. –í –¥–∞–ª—å–Ω–µ–π—à–µ–º –≤ –∏–Ω—Å—Ç–∞–ª–ª–µ—Ä–µ –±—É–¥—É—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.

#### –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —Å –∫–Ω–æ–ø–∫–æ–π —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–∫—Ä–æ—Ñ–æ–Ω–æ–º

–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π Canvas –∏ –¥–æ–±–∞–≤—å—Ç–µ –∫ –Ω–µ–º—É –∫–Ω–æ–ø–∫—É. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –º–∏–∫—Ä–æ—Ñ–æ–Ω –±—É–¥–µ—Ç –≤–∫–ª—é—á–∞—Ç—å—Å—è –∏ –≤—ã–∫–ª—é—á–∞—Ç—å—Å—è.

–ù–∞–ø–∏—à–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∫–Ω–æ–ø–∫–∏:

```csharp
using System;
using UnityEngine;
using UnityEngine.UI;

[RequireComponent(typeof(Button))]
public class MicrophoneButton : MonoBehaviour
{
    public event Action OnMicrophoneToggle;

    private Button _button;

    private void Awake()
    {
        _button = GetComponent<Button>();
    }

    private void OnEnable()
    {
        _button.onClick.AddListener(ToggleMicrophone);
    }

    private void OnDisable()
    {
        _button.onClick.RemoveListener(ToggleMicrophone);
    }

    private void ToggleMicrophone() =>
        OnMicrophoneToggle?.Invoke();
}
```

–î–æ–±–∞–≤—å—Ç–µ —Å–∫—Ä–∏–ø—Ç –∫ –∫–Ω–æ–ø–∫–µ –∏ –ø–æ–¥–ø–∏—à–∏—Ç–µ—Å—å –Ω–∞ —Å–æ–±—ã—Ç–∏–µ `OnMicrophoneToggle`.

```csharp
using UnityEngine;

[RequireComponent(typeof(MicrophoneButton))]
public class MicrophoneButtonHandler : MonoBehaviour
{
    private void Awake()
    {
        var microphoneButton = GetComponent<MicrophoneButton>();
        microphoneButton.OnMicrophoneToggle += OnMicrophoneToggle;
    }

    private void OnMicrophoneToggle()
    {
        var serviceLocator = ServiceLocator.Instance;
        var audioRecorder = serviceLocator.Get<IAudioRecorder>();

        if (Microphone.IsRecording(Microphone.devices[0]))
        {
            audioRecorder.StopRecording();
        }
        else
        {
            audioRecorder.StartRecording();
        }
    }
}
```

–ë—ã–ª —Å–æ–∑–¥–∞–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –≤–∫–ª—é—á–∞–µ—Ç –∏–ª–∏ –≤—ã–∫–ª—é—á–∞–µ—Ç –º–∏–∫—Ä–æ—Ñ–æ–Ω. –ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –∞—É–¥–∏–æ, –∞ –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–∏–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –∑–∞–ø–∏—Å—å –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è.

#### –°–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏

–ù–∞–ø–∏—à–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏ –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ç–µ–∫—Å—Ç –∏–∑ –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã—Ö.

```csharp
public interface ISpeechRecognizer
{
    Task<string> GetTextAsync(float[] samples);
}
```

–°–æ–∑–¥–∞–¥–∏–º —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º WhisperManager.

```csharp
using System.Threading.Tasks;
using Whisper;

public class SpeechRecognizer : ISpeechRecognizer
{
    private readonly WhisperManager _whisperManager = ServiceLocator.Instance.Get<WhisperManager>();

    public async Task<string> GetTextAsync(float[] samples)
    {
        var whisperResult = await _whisperManager.GetTextAsync(samples, 16000, 1);
        return whisperResult.Result;
    }
}
```

–û–±–Ω–æ–≤–∏–º –∏–Ω—Å—Ç–∞–ª–ª–µ—Ä –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –∏ –¥–æ–±–∞–≤–∏–º WhisperManager.

```csharp
using UnityEngine;
using Whisper;

public class DependencyInstaller : MonoBehaviour
{
    [SerializeField] private WhisperManager whisperManager;
    
    private void Awake()
    {
        var serviceLocator = ServiceLocator.Instance;

        serviceLocator.Register<WhisperManager>(whisperManager);
        
        var audioRecorder = new AudioRecorder();
        serviceLocator.Register<IAudioRecorder>(audioRecorder);
        
        var speechRecognizer = new SpeechRecognizer();
        serviceLocator.Register<ISpeechRecognizer>(speechRecognizer);
    }
}
```

#### –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞

–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π TextMeshPro –∏ –¥–æ–±–∞–≤—å—Ç–µ –∫ –Ω–µ–º—É —Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞.

```csharp
using TMPro;
using UnityEngine;

[RequireComponent(typeof(TMP_Text))]
public class TextDisplay : MonoBehaviour
{
    private TMP_Text _text;

    private void Awake()
    {
        _text = GetComponent<TMP_Text>();
    }

    public void SetText(string text) => _text.text = text;
}
```

–î–æ–±–∞–≤—å—Ç–µ —Å–∫—Ä–∏–ø—Ç –∫ TextMeshPro.

#### –ù–∞—á–Ω—ë–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥–∏–∫–∏

–ü–æ—Ä–∞ –ø—Ä–∏—Å—Ç—É–ø–∏—Ç—å –∫ —Å–æ–∑–¥–∞–¥–∏—é —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è –¶–∏—Ñ—Ä–æ–≤–æ–≥–æ –ê–≤–∞—Ç–∞—Ä–∞.

–ù–æ –ø–µ—Ä–µ–¥ —ç—Ç–∏–º, –æ–±–Ω–æ–≤–∏–º –Ω–∞—à —Å–µ—Ä–≤–∏—Å –¥–ª—è –∑–∞–ø–∏—Å–∏ –∞—É–¥–∏–æ, –¥–æ–±–∞–≤–∏–≤ –≤ –Ω–µ–≥–æ —Å–æ–±—ã—Ç–∏–µ –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–∏ –æ–∫–æ–Ω–∞—á–∞–Ω–∏–∏ –∑–∞–ø–∏—Å–∏ –∞—É–¥–∏–æ –±—É–¥–µ—Ç –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤—Å–µ –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã–µ.

```csharp
public interface IAudioRecorder
{
    event Action<float[]> OnAudioDataReceived;

    // –í–µ—Å—å –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥
}

–í –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ `IAudioRecorder` –¥–æ–±–∞–≤–ª–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ `OnAudioDataReceived`, –∫–æ—Ç–æ—Ä–æ–µ –ø–µ—Ä–µ–¥–∞—ë—Ç –º–∞—Å—Å–∏–≤ –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã—Ö.

–û–±–Ω–æ–≤–∏–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ `IAudioRecorder`, –¥–æ–±–∞–≤–∏–≤ –≤—ã–∑–æ–≤ —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –∑–∞–ø–∏—Å–∏ –∞—É–¥–∏–æ.

```csharp
public class AudioRecorder : IAudioRecorder
{
    public event Action<float[]> OnAudioDataReceived;

    // –í–µ—Å—å –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥

    public void StopRecording()
    {
        if (_microphoneClip == null) return;

        OnAudioDataReceived?.Invoke(GetAudioData());

        Microphone.End(Microphone.devices[_microphoneIndex]);

        _microphoneClip = null;

        _position1 = 0;
        _position2 = 0;
    }

    // –í–µ—Å—å –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥

    private float[] GetAudioData()
    {
        _position2 = Microphone.GetPosition(Microphone.devices[_microphoneIndex]);

        if (_position2 <= 0) return null;

        var audioData = new float[_position2];
        _microphoneClip.GetData(audioData, 0);
        return audioData;
    }
}
```

–ú—ã –¥–æ–±–∞–≤–∏–ª–∏ —Å–æ–±—ã—Ç–∏–µ `OnAudioDataReceived` –∏ –≤—ã–∑–≤–∞–ª–∏ –µ–≥–æ –ø—Ä–∏ –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –∑–∞–ø–∏—Å–∏ –∞—É–¥–∏–æ. –î–æ–±–∞–≤–∏–ª–∏ –º–µ—Ç–æ–¥ `GetAudioData` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã—Ö.

–¢–µ–ø–µ—Ä—å —Å–æ–∑–¥–∞–¥–∏–º —Å–∫—Ä–∏–ø—Ç –¥–ª—è –¶–∏—Ñ—Ä–æ–≤–æ–≥–æ –ê–≤–∞—Ç–∞—Ä–∞.

```csharp
using System.Threading.Tasks;
using UnityEngine;

public class DigitalAvatar : MonoBehaviour
{
    [SerializeField] private TextDisplay textDisplay;

    private IAudioRecorder _audioRecorder;
    private ISpeechRecognizer _speechRecognizer;

    private void Start()
    {
        var serviceLocator = ServiceLocator.Instance;
        _audioRecorder = serviceLocator.Get<IAudioRecorder>();
        _speechRecognizer = serviceLocator.Get<ISpeechRecognizer>();

        _audioRecorder.OnAudioDataReceived += OnAudioDataReceived;
    }

    private async void OnAudioDataReceived(float[] audioData)
    {
        var text = await RecognizeSpeechAsync(audioData);
        textDisplay.SetText(text);
    }

    private async Task<string> RecognizeSpeechAsync(float[] audioData)
    {
        if (audioData == null) return string.Empty;

        return await _speechRecognizer.GetTextAsync(audioData);
    }
}
```

–°–∫—Ä–∏–ø—Ç –¥–ª—è –¶–∏—Ñ—Ä–æ–≤–æ–≥–æ –ê–≤–∞—Ç–∞—Ä–∞ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏–µ `OnAudioDataReceived` –∏ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥–∞—ë—Ç –∏—Ö –Ω–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏. –†–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ —ç–∫—Ä–∞–Ω–µ.

–î–æ–±–∞–≤—å—Ç–µ —Å–∫—Ä–∏–ø—Ç –Ω–∞ —Å—Ü–µ–Ω—É.

### –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞ —Å –ø–æ–º–æ—â—å—é –ò–ò

```plaintext
–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ —Å –ø–æ–º–æ—â—å—é –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ (–ò–ò) ‚Äî —ç—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è —Å –ø–æ–º–æ—â—å—é –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–π.

–ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã: –Ω–µ–π—Ä–æ—Å–µ—Ç—å –ø–æ–≥–ª–æ—â–∞–µ—Ç –æ–≥—Ä–æ–º–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω—ã—Ö, –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏—Ö –∏ —É—á–∏—Ç—Å—è –Ω–∞ –∏—Ö –æ—Å–Ω–æ–≤–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å —á—Ç–æ-—Ç–æ –Ω–æ–≤–æ–µ. –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–∞—ë—Ç –∑–∞–ø—Ä–æ—Å, –Ω–µ–π—Ä–æ—Å–µ—Ç—å –Ω–∞—á–∏–Ω–∞–µ—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —ç—Ç—É –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –≤—ã–±–∏—Ä–∞–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏–µ —Ñ—Ä–∞–∑—ã –∏ —Å–æ–∑–¥–∞—ë—Ç —Ç–µ–∫—Å—Ç, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ –≤—Å—ë–º, —á—Ç–æ –æ–Ω–∞ ¬´—É–∑–Ω–∞–ª–∞¬ª.
```

–ß–∞—â–µ –≤—Å–µ–≥–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ —Å –ø–æ–º–æ—â—å—é –ò–ò –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä–∞—Ö –±–æ–ª—å—à–∏—Ö –∫–æ–º–ø–∞–Ω–∏–π, —Ç–∞–∫–∏—Ö –∫–∞–∫ Google, Microsoft, OpenAI –∏ –¥—Ä—É–≥–∏—Ö. –û–Ω–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–µ–π—Ä–æ—Å–µ—Ç—è–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç.

–ù–æ —è–∑—ã–∫–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –∏ –ª–æ–∫–∞–ª—å–Ω–æ. –î–ª—è —ç—Ç–æ–≥–æ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –ø–æ–∑–≤–æ–ª—è—é—â–∏–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞.

#### Unity LLM

LLM –¥–ª—è Unity –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–ª–∞–≤–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –±–æ–ª—å—à–∏—Ö —è–∑—ã–∫–æ–≤—ã—Ö –º–æ–¥–µ–ª–µ–π (LLM) –≤ –¥–≤–∏–∂–æ–∫ Unity engine.
–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –≤–∞—à–∏ –∏–≥—Ä–æ–∫–∏ –º–æ–≥—É—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞—Ö–≤–∞—Ç—ã–≤–∞—é—â–µ–≥–æ –æ–ø—ã—Ç–∞.

LLM –¥–ª—è Unity –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –±–∞–∑–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ llama.cpp

##### –ö—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ –æ–± –±–∏–±–ª–∏–æ—Ç–µ–∫–µ

* üíª –ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–π! Windows, Linux, macOS –∏ Android
* üè† –†–∞–±–æ—Ç–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω–æ –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –≤ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç. –ù–∏–∫–∞–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–∫–∏–¥–∞—é—Ç –∏–≥—Ä—É!
* ‚ö° –ù–µ–≤–µ—Ä–æ—è—Ç–Ω–æ –±—ã—Å—Ç—Ä—ã–π –≤—ã–≤–æ–¥ –Ω–∞ CPU –∏ GPU (Nvidia, AMD, Apple Metal)
* ü§ó –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥–µ–ª–∏ LLM
* üîß –ü—Ä–æ—Å—Ç–æ—Ç–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –≤—ã–∑–æ–≤ —Å –ø–æ–º–æ—â—å—é –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞
* üí∞ –ë–µ—Å–ø–ª–∞—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –≤ –ª–∏—á–Ω—ã—Ö, —Ç–∞–∫ –∏ –≤ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö —Ü–µ–ª—è—Ö

üß™ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ Unity: 2021 LTS, 2022 LTS, 2023

#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Unity LLM

* –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–∫—Ç–∏–≤ –∏–∑ Unity Asset Store - <https://assetstore.unity.com/packages/tools/ai-ml-integration/llm-for-unity-273604> (–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–≥–∞—é—Ç—Å—è)
* –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Å –ø–æ–º–æ—â—å—é Git - <https://github.com/undreamai/LLMUnity.git> (–ë–µ–∑ –ø—Ä–∏–º–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Unity LLM

–°–Ω–∞—á–∞–ª–∞ –≤—ã –Ω–∞—Å—Ç—Ä–æ–∏—Ç–µ LLM –¥–ª—è —Å–≤–æ–µ–π –∏–≥—Ä—ã:

* –°–æ–∑–¥–∞–π—Ç–µ –ø—É—Å—Ç–æ–π GameObject.
* –í –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–µ –¥–æ–±–∞–≤—å—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç LLM.
  * –ó–∞–≥—Ä—É–∑–∏—Ç–µ –æ–¥–Ω—É –∏–∑ –º–æ–¥–µ–ª–µ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å –ø–æ–º–æ—â—å—é Download Model –∫–Ω–æ–ø–∫–∏ (~GBs).
  * –ò–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–≤–æ—é —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å .gguf —Å –ø–æ–º–æ—â—å—é Load model –∫–Ω–æ–ø–∫–∏.

–ó–∞—Ç–µ–º –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–∞–∂–¥–æ–≥–æ –∏–∑ —Å–≤–æ–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

* –°–æ–∑–¥–∞–π—Ç–µ –ø—É—Å—Ç–æ–π –∏–≥—Ä–æ–≤–æ–π –æ–±—ä–µ–∫—Ç –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞.
* –í –∏–Ω—Å–ø–µ–∫—Ç–æ—Ä–µ –¥–æ–±–∞–≤—å—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç LLMCharacter.
* –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Ä–æ–ª—å –≤–∞—à–µ–≥–æ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ –≤ Prompt. –í—ã –º–æ–∂–µ—Ç–µ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏–º—è –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ (AI Name) –∏ –∏–≥—Ä–æ–∫–∞ (Player Name).
* (–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) –í—ã–±–µ—Ä–∏—Ç–µ LLM, —Å–æ–∑–¥–∞–Ω–Ω—ã–π –≤—ã—à–µ, –≤ –ø–æ–ª–µ LLM, –µ—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –±–æ–ª–µ–µ –æ–¥–Ω–æ–≥–æ –∏–≥—Ä–æ–≤–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ LLM.

–û–±–Ω–æ–≤–∏–º –ø—Ä–æ–º—Ç —É –Ω–∞—à–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –Ω–∞ —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫ –¥–ª—è –±–æ–ª–µ–µ –ø–æ–Ω—è—Ç–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è.

```plaintext
–ë–µ—Å–µ–¥–∞ –º–µ–∂–¥—É –ª—é–±–æ–ø—ã—Ç–Ω—ã–º —á–µ–ª–æ–≤–µ–∫–æ–º –∏ –ø–æ–º–æ—â–Ω–∏–∫–æ–º –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞. –ü–æ–º–æ—â–Ω–∏–∫ –¥–∞–µ—Ç –ø–æ–ª–µ–∑–Ω—ã–µ, –ø–æ–¥—Ä–æ–±–Ω—ã–µ –∏ –≤–µ–∂–ª–∏–≤—ã–µ –æ—Ç–≤–µ—Ç—ã –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã —á–µ–ª–æ–≤–µ–∫–∞.
```

–í—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å LLM –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –≤–∞—à–∏–º–∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è–º–∏.

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

```csharp
using LLMUnity;

public class GameLogic : MonoBehaviour 
{
    [SerializeField] private LLMCharacter llmCharacter;

    private void Start()
    {
        // –≤–∞—à–∞ –∏–≥—Ä–æ–≤–∞—è –ª–æ–≥–∏–∫–∞
        string message = "–ü—Ä–∏–≤–µ—Ç, –±–æ—Ç!";
        _ = llmCharacter.Chat(message, HandleReply);
    }

    private void HandleReply(string reply)
    {
        // —Å–¥–µ–ª–∞–π—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å —Å –æ—Ç–≤–µ—Ç–æ–º –º–æ–¥–µ–ª–∏
        Debug.Log(reply);
    }
}
```

–í–æ—Ç –∏ –≤—Å–µ ‚ú®!

–ú—ã –∂–µ —Å –≤–∞–º–∏ —Å–Ω–∞—á–∞–ª–∞ –ø–æ–ø—Ä–æ–±—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –º–æ–¥–µ–ª—å, –∞ –ø–æ—Å–ª–µ –≤–æ–∑—å–º—ë–º –µ—ë –∏ –¥–æ —Ç—Ä–µ–Ω–∏—Ä—É–µ–º –µ—ë –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–≤–æ–µ–≥–æ –¥–∞—Ç–∞—Å–µ—Ç–∞.

#### –ù–∞–ø–∏—Å–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Unity LLM

–°–æ–∑–¥–∞–¥–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Unity LLM. –°–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Ö–æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.

–í —Å–µ—Ä–≤–∏—Å–µ –±—É–¥–µ—Ç:

* –ø–∞—Ä–∞–º–µ—Ç—Ä `IsGenerating`, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å, –∏–¥—ë—Ç –ª–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞.
* –º–µ—Ç–æ–¥ `StartGeneration`, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Ö–æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è. –ú–µ—Ç–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç.
* –º–µ—Ç–æ–¥ `StopGeneration`, –∫–æ—Ç–æ—Ä—ã–π –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Ç–µ–∫—Å—Ç–∞.
* —Å–æ–±—ã—Ç–∏–µ `OnMessageReceived`, –∫–æ—Ç–æ—Ä–æ–µ –ø–µ—Ä–µ–¥–∞—ë—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–π —Ç–µ–∫—Å—Ç.
* —Å–æ–±—ã—Ç–∏–µ `OnMessageReceivedCompleted`, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞.

```csharp
public interface IConversationGeneration
{
    bool IsGenerating { get; }

    event Action<string> OnMessageReceived;
    event Action OnMessageReceivedCompleted;

    Task<string> StartGeneration(string message);
    void StopGeneration();
}
```

–°–æ–∑–¥–∞–¥–∏–º —Å–µ—Ä–≤–∏—Å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ Unity LLM.

–†–µ–∞–ª–∏–∑—É–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –¥–æ–±–∞–≤–∏–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å–æ–±—ã—Ç–∏—è –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã. –¢–∞–∫ –∂–µ —Å–∞–º –∫–ª–∞—Å—Å –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≤ —Å–µ–±–µ LLMCharacter.

```csharp
public class ConversationGeneration : IConversationGeneration
{
    public event Action<string> OnMessageReceived;
    public event Action OnMessageReceivedCompleted;

    public bool IsGenerating { get; private set; }

    private readonly LLMCharacter _llmCharacter = ServiceLocator.Instance.Get<LLMCharacter>();
}
```

–î–æ–±–∞–≤–∏–º –º–µ—Ç–æ–¥—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Ö–æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.

* –ú–µ—Ç–æ–¥ `StartGeneration` –∑–∞–ø—É—Å–∫–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Ö–æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.
* –ú–µ—Ç–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—Å—Ç. –ú–µ—Ç–æ–¥ `StopGeneration` –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é —Ç–µ–∫—Å—Ç–∞.

```csharp
public async Task<string> StartGeneration(string message)
{
    if (IsGenerating) return null;

    IsGenerating = true;

    return await _llmCharacter.Chat(message, MessageReceived, MessageReceivedComplete);
}

public void StopGeneration()
{
    _llmCharacter.CancelRequests();

    IsGenerating = false;
}
```

–î–æ–±–∞–≤–∏–º –º–µ—Ç–æ–¥—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏–π.

* –ú–µ—Ç–æ–¥ `MessageReceived` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è.
* –ú–µ—Ç–æ–¥ `MessageReceivedComplete` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞.

```csharp
private void MessageReceived(string message)
{
    OnMessageReceived?.Invoke(message);
}

private void MessageReceivedComplete()
{
    IsGenerating = false;
    OnMessageReceivedCompleted?.Invoke();
}
```

–î–æ–±–∞–≤—å—Ç–µ —Å–µ—Ä–≤–∏—Å –≤ –∏–Ω—Å—Ç–∞–ª–ª–µ—Ä –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

```csharp
using LLMUnity;
using UnityEngine;
using Whisper;

public class DependencyInstaller : MonoBehaviour
{
    [SerializeField] private WhisperManager whisperManager;
    [SerializeField] private LLMCharacter llmCharacter;
    
    private void Awake()
    {
        var serviceLocator = ServiceLocator.Instance;

        serviceLocator.Register<WhisperManager>(whisperManager);
        serviceLocator.Register<LLMCharacter>(llmCharacter);
        
        var audioRecorder = new AudioRecorder();
        serviceLocator.Register<IAudioRecorder>(audioRecorder);
        
        var speechRecognizer = new SpeechRecognizer();
        serviceLocator.Register<ISpeechRecognizer>(speechRecognizer);
        
        var conversationGeneration = new ConversationGeneration();
        serviceLocator.Register<IConversationGeneration>(conversationGeneration);
    }
}
```

#### –û–±–Ω–æ–≤–∏–º –ª–æ–≥–∏–∫—É –ê–≤–∞—Ç–∞—Ä–∞ —á—Ç–æ –±—ã –æ–Ω –º–æ–≥ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç

–û–±–Ω–æ–≤–∏–º —Å–∫—Ä–∏–ø—Ç –¥–ª—è –¶–∏—Ñ—Ä–æ–≤–æ–≥–æ –ê–≤–∞—Ç–∞—Ä–∞, –¥–æ–±–∞–≤–∏–≤ –≤ –Ω–µ–≥–æ —Å–µ—Ä–≤–∏—Å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞.

* –î–æ–±–∞–≤–∏–º —Å–µ—Ä–≤–∏—Å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞ –≤ –¶–∏—Ñ—Ä–æ–≤–æ–π –ê–≤–∞—Ç–∞—Ä.
* –ü–æ–¥–ø–∏—à–µ–º—Å—è –Ω–∞ —Å–æ–±—ã—Ç–∏–µ `OnMessageReceived` –∏ –æ—Ç–æ–±—Ä–∞–∑–∏–º –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç.
* –û–±–Ω–æ–≤–∏–º –º–µ—Ç–æ–¥ `OnAudioDataReceived`, —á—Ç–æ–±—ã –æ–Ω –ø–µ—Ä–µ–¥–∞–≤–∞–ª —Ç–µ–∫—Å—Ç –≤ –º–æ–¥–µ–ª—å.

```csharp
public class DigitalAvatar : MonoBehaviour
{
    // –°—Ç–∞—Ä—ã–π –∫–æ–¥

    private IConversationGeneration _conversationGeneration;

    private void Start()
    {
        var serviceLocator = ServiceLocator.Instance;
        _audioRecorder = serviceLocator.Get<IAudioRecorder>();
        _speechRecognizer = serviceLocator.Get<ISpeechRecognizer>();
        _conversationGeneration = serviceLocator.Get<IConversationGeneration>();

        _audioRecorder.OnAudioDataReceived += OnAudioDataReceived;
        _conversationGeneration.OnMessageReceived += OnMessageReceived;
    }

    private async void OnAudioDataReceived(float[] audioData)
    {
        var text = await RecognizeSpeechAsync(audioData);

        await _conversationGeneration.StartGeneration(text);
    }

    // –°—Ç–∞—Ä—ã–π –∫–æ–¥

    private void OnMessageReceived(string message)
    {
        textDisplay.SetText(message);
    }
}
```

### –°–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏

–°–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏ ‚Äî —ç—Ç–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–µ—á–∏. –î–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—Ç —Ç–µ–∫—Å—Ç –≤ —Ä–µ—á—å.

–ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ [piper](https://github.com/rhasspy/piper).

piper - –ë—ã—Å—Ç—Ä–∞—è –ª–æ–∫–∞–ª—å–Ω–∞—è –Ω–µ–π—Ä–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –≤ —Ä–µ—á—å.

#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω—É–∂–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ –¥–ª—è —Å–∏–Ω—Ç–µ–∑–∞ —Ä–µ—á–∏

* [–°–∫–∞—á–∞–π—Ç–µ espeak-ng.dll](https://github.com/espeak-ng/espeak-ng/releases) –∏ –ø–æ–º–µ—Å—Ç–∏—Ç–µ –µ–≥–æ –≤ –ø–∞–ø–∫—É Plugins/Windows.
  * eSpeak NG - —ç—Ç–æ —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä —Ä–µ—á–∏ —Å –æ—Ç–∫—Ä—ã—Ç—ã–º –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –±–æ–ª–µ–µ —Å—Ç–∞ —è–∑—ã–∫–æ–≤ –∏ –∞–∫—Ü–µ–Ω—Ç–æ–≤.
* [–°–∫–∞—á–∞–π—Ç–µ piper_phonemize.dll](https://github.com/rhasspy/piper-phonemize/releases) –∏ –ø–æ–º–µ—Å—Ç–∏—Ç–µ –µ–≥–æ –≤ –ø–∞–ø–∫—É Plugins/Windows.
  * piper phonemize - –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ C++ –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –≤ —Ñ–æ–Ω–µ–º—ã –¥–ª—è Piper.
* [–°–∫–∞—á–∞–π—Ç–µ espeak-ng-data](https://github.com/RTU-TVP/espeak-ng-data) –∏ –ø–æ–º–µ—Å—Ç–∏—Ç–µ –µ–≥–æ –≤ –ø–∞–ø–∫—É StreamingAssets.
* –ó–∞–≥—Ä—É–∑–∏—Ç–µ .onnx —Ñ–∞–π–ª –º–æ–¥–µ–ª–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä ru_RU-irina-medium.onnx –∏ –ø–æ–º–µ—Å—Ç–∏—Ç–µ –µ–≥–æ –≤ –ø–∞–ø–∫—É Resources.
* –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–∞–∫–µ—Ç Sentis –≤ Unity. –ü–∞–∫–µ—Ç Sentis –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–µ –ø–∞–∫–µ—Ç–æ–≤ Unity.
  * Sentis ‚Äî —ç—Ç–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–µ–π—Ä–æ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π –¥–ª—è Unity. –í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Sentis –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞ –æ–±—É—á–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –Ω–µ–π—Ä–æ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π –≤ Unity, –∞ –∑–∞—Ç–µ–º –∑–∞–ø—É—Å–∫–∞—Ç—å –∏—Ö –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏.

–í—ã –º–æ–∂–µ—Ç–µ –Ω–∞–π—Ç–∏ [–±–æ–ª—å—à–µ –º–æ–¥–µ–ª–µ–π piper –∑–¥–µ—Å—å](https://huggingface.co/rhasspy/piper-voices). –ö –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏ –ø—Ä–∏–ª–∞–≥–∞–µ—Ç—Å—è –∫–∞—Ä—Ç–æ—á–∫–∞ –º–æ–¥–µ–ª–∏, –æ–ø–∏—Å—ã–≤–∞—é—â–∞—è –Ω–∞–±–æ—Ä –æ–±—É—á–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –ª–∏—Ü–µ–Ω–∑–∏—é.

–í–∞–º —Ç–∞–∫–∂–µ –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å "–≥–æ–ª–æ—Å" (–∫–æ–¥ —è–∑—ã–∫–∞) –∏ —á–∞—Å—Ç–æ—Ç—É –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü–∏–∏ –¥–ª—è –º–æ–¥–µ–ª–∏. –≠—Ç–æ –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ json, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω–æ–º —Ä—è–¥–æ–º —Å –º–æ–¥–µ–ª—å—é.

#### –ù–∞–ø–∏—Å–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è —Å–∏–Ω—Ç–µ–∑–∞ —Ä–µ—á–∏

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫, —Å–æ–∑–¥–∞–¥–∏–º —Å–µ—Ä–≤–∏—Å –¥–ª—è —Å–∏–Ω—Ç–µ–∑–∞ —Ä–µ—á–∏.

–°–æ–∑–¥–∞–¥–∏–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å piper –¥–ª—è —Å–∏–Ω—Ç–µ–∑–∞ —Ä–µ—á–∏. –°–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ç–µ–∫—Å—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∞—É–¥–∏–æ –¥–∞–Ω–Ω—ã–µ.

```csharp
public interface ISpeechSynthesis
{
    Task<AudioClip> TextToSpeech(string text);
}
```

–¢–µ–ø–µ—Ä—å –ø—Ä–∏—Å—Ç—É–ø–∏–º –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–µ—Ä–≤–∏—Å–∞.

–í –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ —Å–µ—Ä–≤–∏—Å–∞ –º—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º piper –∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥–µ–ª—å. –ü–µ—Ä–µ–¥–∞–µ–º –º–æ–¥–µ–ª—å, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π —è–∑—ã–∫ –∏ —á–∞—Å—Ç–æ—Ç—É –¥–∏—Å–∫—Ä–µ—Ç–∏–∑–∞—Ü–∏–∏.

–ü–æ—Å–ª–µ —á–µ–≥–æ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ –∏–Ω–∏—Ç–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –∑–∞–≥—Ä—É–∑–∏–º –º–æ–¥–µ–ª—å –∏ —Å–æ–∑–¥–∞–¥–∏–º —ç–∫–∑–µ–º–ø–ª—è—Ä Worker.

```plaintext
Worker ‚Äî —ç—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º –ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–≤–æ–¥–∞. –í—ã —Å–æ–∑–¥–∞—ë—Ç–µ —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å, —á—Ç–æ–±—ã —Ä–∞–∑–±–∏—Ç—å –º–æ–¥–µ–ª—å –Ω–∞ –≤—ã–ø–æ–ª–Ω–∏–º—ã–µ –∑–∞–¥–∞—á–∏, –∑–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–¥–∞—á–∏ –Ω–∞ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–º –∏–ª–∏ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–º –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–µ –∏ –ø–æ–ª—É—á–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
```

–î–æ–±–∞–≤–∏–º –º–µ—Ç–æ–¥ Dispose –¥–ª—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤.

```csharp
public class SpeechSynthesisWithPiper : ISpeechSynthesis, IDisposable
{
    private const BackendType BACKEND = BackendType.GPUCompute;
    private readonly string _voice;
    private readonly int _sampleRate;

    private readonly Worker _worker;

    public SpeechSynthesisWithPiper(ModelAsset model, string language = "ru", int sampleRate = 22050)
    {
        _voice = language;
        _sampleRate = sampleRate;

        var espeakPath = Path.Combine(Application.streamingAssetsPath, "espeak-ng-data");
        PiperWrapper.InitPiper(espeakPath);

        var runtimeModel = ModelLoader.Load(model);

        _worker = new Worker(runtimeModel, BACKEND);
    }

    public void Dispose()
    {
        PiperWrapper.FreePiper();
        _worker?.Dispose();
    }
```

–°–æ–∑–¥–∞–¥–∏–º –º–µ—Ç–æ–¥ –∫–æ—Ç–æ—Ä—ã–π –≤ –¥–∞–ª—å–Ω–µ–π–¥–µ–º –±—É–¥–µ—Ç –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞—Ç—å —á–∏—Å–ª–æ–≤–æ–π —Ñ–æ—Ä–º–∞—Ç –≤ –∞—É–¥–∏–æ —Ñ–æ—Ä–º–∞—Ç.

```csharp
private AudioClip CreateAudioClip(List<float> audioBuffer)
{
    var audioClip = AudioClip.Create("piper_tts", audioBuffer.Count, 1, _sampleRate, false);
    audioClip.SetData(audioBuffer.ToArray(), 0);
    return audioClip;
}
```

–î–æ–±–∞–≤–∏–º –º–µ—Ç–æ–¥ –¥–ª—è —Å–∏–Ω—Ç–µ–∑–∞ —Ä–µ—á–∏.

```csharp
public async Task<AudioClip> TextToSpeech(string text)
{
    var phonemes = PiperWrapper.ProcessText(text, _voice);

    var inputLengthsShape = new TensorShape(1);
    var scalesShape = new TensorShape(3);
    using var scalesTensor = new Tensor<float>(scalesShape, new[] { 0.667f, 1f, 0.8f });

    var audioBuffer = new List<float>();
    foreach (var sentence in phonemes.Sentences)
    {
        var inputPhonemes = sentence.PhonemesIds;
        var inputShape = new TensorShape(1, inputPhonemes.Length);
        using var inputTensor = new Tensor<int>(inputShape, inputPhonemes);
        using var inputLengthsTensor = new Tensor<int>(inputLengthsShape, new[] { inputPhonemes.Length });

        _worker.SetInput("input", inputTensor);
        _worker.SetInput("input_lengths", inputLengthsTensor);
        _worker.SetInput("scales", scalesTensor);

        _worker.Schedule();

        using var outputTensor = _worker.PeekOutput() as Tensor<float>;
        await outputTensor.ReadbackAndCloneAsync();

        var output = outputTensor.AsReadOnlySpan().ToArray();
        audioBuffer.AddRange(output);
    }

    return CreateAudioClip(audioBuffer);
}
```

–î–æ–±–∞–≤–∏–º —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å –≤ –∏–Ω—Å—Ç–∞–ª–ª–µ—Ä –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

```csharp
using LLMUnity;
using UnityEngine;
using Whisper;

public class DependencyInstaller : MonoBehaviour
{
    [SerializeField] private WhisperManager whisperManager;
    [SerializeField] private LLMCharacter llmCharacter;
    [SerializeField] private ModelAsset model;
    [SerializeField] private string language;
    [SerializeField] private int sampleRate;

    private void Awake()
    {
        var serviceLocator = ServiceLocator.Instance;

        serviceLocator.Register<WhisperManager>(whisperManager);
        serviceLocator.Register<LLMCharacter>(llmCharacter);

        var audioRecorder = new AudioRecorder();
        serviceLocator.Register<IAudioRecorder>(audioRecorder);

        var speechRecognizer = new SpeechRecognizer();
        serviceLocator.Register<ISpeechRecognizer>(speechRecognizer);

        var conversationGeneration = new ConversationGeneration();
        serviceLocator.Register<IConversationGeneration>(conversationGeneration);

        var speechSynthesis = new SpeechSynthesisWithPiper(model, language, sampleRate);
        serviceLocator.Register<ISpeechSynthesis>(speechSynthesis);
    }
}
```

#### –û–±–Ω–æ–≤–∏–º –ª–æ–≥–∏–∫—É –ê–≤–∞—Ç–∞—Ä–∞ —á—Ç–æ –±—ã –æ–Ω –º–æ–≥ –ø—Ä–æ–∏–≥—Ä—ã–≤–∞—Ç—å –∞—É–¥–∏–æ

–î–æ–±–∞–≤–∏–º —Å—Å—ã–ª–∫—É –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏ –≤—ã–≤–æ–¥–∞ –∑–≤—É–∫–∞

```csharp
[SerializeField] private AudioSource audioSource;
```

–î–æ–±–∞–≤–∏–º –Ω–æ–≤—ãe —Å–µ—Ä–≤–∏—Å—ã.

```csharp
private IAudioRecorder _audioRecorder;
private ISpeechRecognizer _speechRecognizer;
private IConversationGeneration _conversationGeneration;
private ISpeechSynthesis _speechSynthesis;

private void Start()
{
    var serviceLocator = ServiceLocator.Instance;
    _audioRecorder = serviceLocator.Get<IAudioRecorder>();
    _speechRecognizer = serviceLocator.Get<ISpeechRecognizer>();
    _conversationGeneration = serviceLocator.Get<IConversationGeneration>();
    _speechSynthesis = serviceLocator.Get<ISpeechSynthesis>();

    _audioRecorder.OnAudioDataReceived += OnAudioDataReceived;
    _conversationGeneration.OnMessageReceived += OnMessageReceived;
}
```

–û–±–Ω–æ–≤–∏–º –ª–æ–≥–∏–∫—É –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞. –°–¥–µ–ª–∞–µ–º —Ç–∞–∫ —á—Ç–æ –±—ã –º—ã –µ–≥–æ –ø–æ–ª—É—á–∞–ª–∏ —Å –ø–æ–º–æ—â—å—é —Å–µ—Ä–≤–∏—Å–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞, –∞ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∏ –µ–≥–æ –Ω–∞ —Å–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏.

```csharp
private string _generatedText;

private void OnMessageReceived(string message)
{
    _generatedText = message;
}

private async void OnMessageReceivedCompleted()
{
    Debug.Log($"–ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ: {_generatedText}");

    microphoneButton.SetIsInteractable(true);

    var audioClip = await _speechSynthesis.TextToSpeech(_generatedText);
    audioSource.PlayOneShot(audioClip);
}
```

#### –û–±–Ω–æ–≤–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

–£–¥–∞–ª–∏–º TextDisplay:

* —É–¥–∞–ª–∏–º —Å–∫—Ä–∏–ø—Ç TextDisplay.
* —É–¥–∞–ª–∏–º –æ–±—ä–µ–∫—Ç –≤ –∏–µ—Ä–∞—Ä—Ö–∏–∏.
* —É–¥–∏–ª–∏–º –≤—Å–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ TextDisplay.

–î–æ–±–∞–≤–∏–º –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –∏ –≤–∫–ª—é—á–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–Ω–æ–ø–∫–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞.

–î–æ–±–∞–≤–∏–º –º–µ—Ç–æ–¥ –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∏ –≤–∫–ª—é—á–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–Ω–æ–ø–∫–∏ –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞.

```csharp
public void SetIsInteractable(bool isInteractable)
{
    _button.interactable = isInteractable;
}
```

–û–±–Ω–æ–≤–∏–º –ª–æ–≥–∏–∫—É –ê–≤–∞—Ç–∞—Ä–∞.

–î–æ–±–∞–≤–∏–º –ø–æ–¥–ø–∏—Å–∫—É –Ω–∞ —Å–æ–±—ã—Ç–∏–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–Ω–∏—è –∞—É–¥–∏–æ.

```csharp
private void Start()
{
    // –°—Ç–∞—Ä—ã–π –∫–æ–¥
    _playingSounds.OnSoundFinished += OnSoundFinished;
}
```

–î–æ–±–∞–≤–∏–º —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–æ–ø–∫—É –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞.

```csahrp
[SerializeField] private MicrophoneButton microphoneButton;
```

–û–±–Ω–æ–≤–∏–º –º–µ—Ç–æ–¥ –ø–æ–ª—É—á–µ–Ω–∏—è –∞—É–¥–∏–æ –æ—Ç –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞.

```csharp
private async void OnAudioDataReceived(float[] audioData)
{
    microphoneButton.SetIsInteractable(false);

    var text = await RecognizeSpeechAsync(audioData);

    await _conversationGeneration.StartGeneration(text);
}
```

–†–µ–∞–ª–∏–∑—É–µ–º –º–µ—Ç–æ–¥ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–±—ã—Ç–∏—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–Ω–∏—è –∞—É–¥–∏–æ.

```csharp
private void OnSoundFinished()
{
    microphoneButton.SetIsInteractable(true);
}
```

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ü–µ–Ω—ã

–ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—É DigitalAvatar –¥–æ–±–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–Ω–æ–ø–∫—É –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞.

–í DependencyInstaller –¥–æ–±–∞–≤—å—Ç–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ –ø—Ä–∏—Å–≤–æ–π—Ç–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º.

#### –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

–ü–æ–∑–¥—Ä–∞–≤–ª—è—é! –í—ã —Å–æ–∑–¥–∞–ª–∏ –¶–∏—Ñ—Ä–æ–≤–æ–≥–æ –ê–≤–∞—Ç–∞—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å —Ä–µ—á—å, –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç –∏ –ø—Ä–æ–∏–∑–Ω–æ—Å–∏—Ç—å –µ–≥–æ.

## –ê–≤—Ç–æ—Ä—ã

### –ê–≤—Ç–æ—Ä –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫

* –ö–∏—Ä–∏–ª–ª –®—É—Ç–æ–≤ (ShutovKS), –†–æ—Å—Å–∏—è

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

* **–î–≤–∏–∂–æ–∫:** Unity 6000.0.29f1
* **–Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è:** C#
* **–°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π:** Git
* **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∏:**
  * Whisper (Piper) - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è –∏ —Å–∏–Ω—Ç–µ–∑–∞ —Ä–µ—á–∏
  * LLMUnity - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —è–∑—ã–∫–æ–≤—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏ –≤ Unity —Ç–∏–ø–∞ .gguf
  * Sentis - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–µ–π—Ä–æ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π –¥–ª—è Unity
  * eSpeak NG - —Å–∏–Ω—Ç–µ–∑–∞—Ç–æ—Ä —Ä–µ—á–∏ —Å –æ—Ç–∫—Ä—ã—Ç—ã–º –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º
  * piper phonemize - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ C++ –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –≤ —Ñ–æ–Ω–µ–º—ã –¥–ª—è Piper